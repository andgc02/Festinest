<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Festinest &bull; Festival JSON Studio</title>
    <style>
      :root { --bg:#0b1020; --panel:#11182a; --muted:#8fa3bf; --text:#e6eef8; --primary:#6aa3ff; --accent:#64d2b6; }
      * { box-sizing: border-box; }
      body { margin: 0; font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--text); }
      header { padding: 16px 20px; border-bottom: 1px solid #1b2740; position: sticky; top: 0; background: linear-gradient(180deg, rgba(11,16,32,0.95), rgba(11,16,32,0.8)); backdrop-filter: blur(6px); }
      h1 { margin: 0; font-size: 18px; letter-spacing: 0.2px; }
      .container { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; padding: 16px; max-width: 1200px; margin: 0 auto; }
      .panel { background: var(--panel); border: 1px solid #1b2740; border-radius: 12px; padding: 16px; }
      .panel h2 { margin: 0 0 12px; font-size: 16px; }
      .row { display: grid; grid-template-columns: 180px 1fr; gap: 12px; align-items: center; margin-bottom: 10px; }
      .row label { color: var(--muted); font-weight: 600; }
      input[type="text"], input[type="url"], textarea, select { width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid #2a3a5d; background: #0f1526; color: var(--text); }
      textarea { min-height: 72px; resize: vertical; }
      .hint { color: var(--muted); font-size: 12px; margin-top: 6px; }
      .actions { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 12px; }
      button { padding: 10px 14px; border-radius: 8px; border: 1px solid #2a3a5d; background: #16203a; color: var(--text); cursor: pointer; }
      button.primary { background: #17305c; border-color: #2955a6; color: #e8f2ff; }
      button.accent { background: #0f3b3b; border-color: #1f7b7b; color: #d9fffa; }
      pre { margin: 0; padding: 12px; border-radius: 8px; background: #0b1222; border: 1px solid #1b2740; max-height: 60vh; overflow: auto; }
      .list { display: grid; gap: 8px; }
      .slot { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 8px; }
      .slot input { width: 100%; }
      footer { padding: 10px 16px; color: var(--muted); text-align: center; }
      @media (max-width: 1000px){ .container { grid-template-columns: 1fr; } .row { grid-template-columns: 1fr; } .slot { grid-template-columns: 1fr 1fr; } }
    </style>
  </head>
  <body>
    <header>
      <h1>Festinest &bull; Festival JSON Studio</h1>
    </header>
    <div class="container">
      <section class="panel">
        <h2>Inputs</h2>
        <div class="row"><label for="name">Festival name</label><input id="name" type="text" placeholder="Coachella 2026" /></div>
        <div class="row"><label for="id">Festival id (slug)</label><input id="id" type="text" placeholder="coachella-2026" /></div>
        <div class="row"><label for="location">Location</label><input id="location" type="text" placeholder="Indio, CA" /></div>
        <div class="row"><label for="startdate">Start date (ISO)</label><input id="startdate" type="text" placeholder="2026-04-10" /></div>
        <div class="row"><label for="enddate">End date (ISO)</label><input id="enddate" type="text" placeholder="2026-04-12" /></div>
        <div class="row"><label for="website">Website URL</label><input id="website" type="url" placeholder="https://coachella.com" /></div>
        <h3>Lineup</h3>
        <div id="lineup" class="list"></div>
        <div class="actions">
          <button id="addSlotBtn">Add lineup entry</button>
        </div>
        <div class="actions">
          <button class="primary" id="generateBtn">Generate JSON</button>
          <button id="copyBtn">Copy JSON</button>
          <button class="accent" id="downloadBtn">Download .json</button>
          <button id="saveBtn">Save to repo (festivals)</button>
          <span class="hint">Downloads as <span id="fileOut">festival-id.json</span></span>
        </div>
      </section>
      <section class="panel">
        <h2>Preview JSON</h2>
        <pre id="output">{}</pre>
      </section>
    </div>
    <footer>&copy; Festinest internal tool. No external requests.</footer>
        <script>
      const $ = (id) => document.getElementById(id);
      const nameEl = $("name");
      const idEl = $("id");
      const locationEl = $("location");
      const startEl = $("startdate");
      const endEl = $("enddate");
      const websiteEl = $("website");
      const lineupEl = $("lineup");
      const outputEl = $("output");
      const fileOutEl = $("fileOut");

      function slugify(value) {
        return (value || "").toLowerCase().normalize('NFKD').replace(/[^\w\s-]/g,'').trim().replace(/[\s_]+/g,'-').replace(/-+/g,'-').replace(/^-+|-+$/g,'');
      }
      let idManuallyEdited = false;

      function addLineupRow(data={}){
        const row = document.createElement('div');
        row.className = 'slot';
        row.innerHTML = `
          <input placeholder="artistId" value="${data.artistId||''}" />
          <input placeholder="day" value="${data.day||''}" />
          <input placeholder="stage" value="${data.stage||''}" />
          <input placeholder="time" value="${data.time||''}" />
          <button type="button">&times;</button>
        `;
        row.querySelector('button').addEventListener('click', ()=> { row.remove(); buildJson(); });
        lineupEl.appendChild(row);
      }

      function buildJson(){
        const id = idEl.value.trim() || slugify(nameEl.value.trim());
        const name = nameEl.value.trim();
        const lineup = Array.from(lineupEl.querySelectorAll('.slot')).map((row)=>{
          const [artistIdEl, dayEl, stageEl, timeEl] = row.querySelectorAll('input');
          const entry = { artistId: artistIdEl.value.trim() };
          if (dayEl.value.trim()) entry.day = dayEl.value.trim();
          if (stageEl.value.trim()) entry.stage = stageEl.value.trim();
          if (timeEl.value.trim()) entry.time = timeEl.value.trim();
          return entry;
        }).filter(e=>e.artistId);

        const object = {
          id,
          name,
          ...(locationEl.value.trim()? { location: locationEl.value.trim() } : {}),
          ...(startEl.value.trim()? { startdate: startEl.value.trim() } : {}),
          ...(endEl.value.trim()? { enddate: endEl.value.trim() } : {}),
          ...(websiteEl.value.trim()? { website: websiteEl.value.trim() } : {}),
          ...(lineup.length? { lineup } : {}),
          lastupdated: new Date().toISOString(),
        };
        outputEl.textContent = JSON.stringify(object, null, 2);
        fileOutEl.textContent = `${id||'festival'}.json`;
      }

      $("addSlotBtn").addEventListener('click', (e)=> { e.preventDefault(); addLineupRow(); buildJson(); });
      nameEl.addEventListener('input', ()=>{ if(!idManuallyEdited || !idEl.value.trim()) idEl.value = slugify(nameEl.value); buildJson(); });
      idEl.addEventListener('input', ()=>{ idManuallyEdited = true; buildJson(); });
      locationEl.addEventListener('input', buildJson);
      startEl.addEventListener('input', buildJson);
      endEl.addEventListener('input', buildJson);
      websiteEl.addEventListener('input', buildJson);
      $("generateBtn").addEventListener('click', (e)=> { e.preventDefault(); buildJson(); });
      $("copyBtn").addEventListener('click', (e)=> { e.preventDefault(); navigator.clipboard?.writeText(outputEl.textContent||'{}'); });
      $("downloadBtn").addEventListener('click', (e)=>{ e.preventDefault(); const id = idEl.value.trim() || slugify(nameEl.value.trim()) || 'festival'; const blob = new Blob([outputEl.textContent||'{}'], {type:'application/json;charset=utf-8'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`${id}.json`; a.click(); URL.revokeObjectURL(url); });
      $("saveBtn").addEventListener('click', async (e)=>{
        e.preventDefault(); buildJson();
        try{ const data = JSON.parse(outputEl.textContent||'{}'); const res = await fetch('/api/save-festival',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)}); const body = await res.json(); if(!res.ok) throw new Error(body.error||'Failed to save'); alert('Saved to '+body.path); } catch(err){ alert('Not saved: '+err.message); }
      });

      addLineupRow();
      buildJson();
    </script>
  </body>
  </html>




